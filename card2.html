<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Å–ª–æ–≤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .app {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: calc(100vh - 20px);
        }

        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        /* –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é */
        .mobile-tabs {
            display: flex;
            overflow-x: auto;
            background: #4f46e5;
            padding: 10px;
            gap: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-tab {
            padding: 10px 15px;
            white-space: nowrap;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-weight: 500;
            cursor: pointer;
            flex-shrink: 0;
        }

        .mobile-tab.active {
            background: white;
            color: #4f46e5;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-container {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 180px);
        }

        .content-area {
            flex: 1;
            padding: 20px;
            background: white;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .control-panel {
            background: #f8fafc;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
        }

        .control-panel button {
            margin: 5px;
            min-width: 120px;
        }

        /* –°–ø–∏—Å–æ–∫ –∫–æ–ª–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
        .decks-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .decks-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .deck-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s;
        }

        .deck-card:hover {
            transform: translateY(-2px);
        }

        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .deck-actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 15px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 5px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
            margin: 5px 0;
        }

        button:hover {
            background: #4338ca;
        }

        .btn-secondary {
            background: #6b7280;
        }

        /* –≠–∫—Ä–∞–Ω –∏–∑—É—á–µ–Ω–∏—è */
        .study-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }

        .study-screen.active {
            display: flex;
        }

        .study-header {
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            touch-action: pan-y;
        }

        .card {
            perspective: 1000px;
            width: 100%;
            max-width: 400px;
            height: 250px;
            position: relative;
        }

        @media (min-width: 768px) {
            .card {
                max-width: 500px;
                height: 300px;
            }
        }

        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            padding: 30px;
            text-align: center;
            border-radius: 20px;
            word-break: break-word;
            overflow-wrap: break-word;
            user-select: none;
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
            color: #1f2937;
        }

        .card-back {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            transform: rotateY(180deg);
        }

        .progress-info {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s;
            border-radius: 4px;
        }

        .study-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .swipe-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            border: none;
        }

        .swipe-btn:active {
            transform: scale(0.95);
        }

        .swipe-left {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .swipe-right {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .stat-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4f46e5;
            margin: 5px 0;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            animation: slideUp 0.3s, fadeOut 0.3s 2.7s forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        /* –ü–∞–ø–∫–∏ */
        .folder-item {
            background: #f8fafc;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .folder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* –ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞ */
        .multi-select {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .iteration-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .iteration-btn {
            padding: 6px 12px;
            background: #f1f5f9;
            border-radius: 15px;
            cursor: pointer;
            font-size: 13px;
            border: none;
            white-space: nowrap;
        }

        .iteration-btn.active {
            background: #4f46e5;
            color: white;
        }

        /* –•–∏–Ω—Ç—ã */
        .hint {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
        @media (max-width: 480px) {
            .swipe-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            .card {
                height: 200px;
            }
            
            .card-front, .card-back {
                font-size: 20px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1>üìö –£–º–Ω—ã–µ –ö–∞—Ä—Ç–æ—á–∫–∏</h1>
            <p>–ò–∑—É—á–∞–π—Ç–µ —Å–ª–æ–≤–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</p>
            <div style="margin-top: 15px;">
                <button onclick="exportData()" class="btn-secondary" style="width: auto; display: inline-block; margin: 5px;">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button onclick="importData()" class="btn-secondary" style="width: auto; display: inline-block; margin: 5px;">üì• –ò–º–ø–æ—Ä—Ç</button>
            </div>
        </header>

        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
        <div class="mobile-tabs">
            <div class="mobile-tab active" onclick="showMobileTab('home')">üè† –ì–ª–∞–≤–Ω–∞—è</div>
            <div class="mobile-tab" onclick="showMobileTab('folders')">üìÅ –ü–∞–ø–∫–∏</div>
            <div class="mobile-tab" onclick="showMobileTab('decks')">üÉè –ö–æ–ª–æ–¥—ã</div>
            <div class="mobile-tab" onclick="showMobileTab('multi')">üéØ –ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞</div>
            <div class="mobile-tab" onclick="showMobileTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        </div>

        <div class="main-container">
            <div class="content-area">
                <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                <div id="home-tab" class="tab-content active">
                    <div class="control-panel">
                        <button onclick="showCreateDeckModal()" class="btn-success">+ –ù–æ–≤–∞—è –∫–æ–ª–æ–¥–∞</button>
                        <button onclick="showCreateFolderModal()" class="btn-primary">+ –ù–æ–≤–∞—è –ø–∞–ø–∫–∞</button>
                    </div>

                    <div class="hint">
                        üí° <strong>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞:</strong><br>
                        –í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:<br>
                        <code>—Å–ª–æ–≤–æ: –ø–µ—Ä–µ–≤–æ–¥</code><br>
                        –ù–∞–ø—Ä–∏–º–µ—Ä:<br>
                        <code>apple: —è–±–ª–æ–∫–æ</code><br>
                        <code>cat: –∫–æ—Ç</code>
                    </div>

                    <h3 style="margin: 20px 0 10px 0;">–í–∞—à–∏ –∫–æ–ª–æ–¥—ã:</h3>
                    <div id="home-decks-list" class="decks-grid"></div>

                    <div id="no-decks-message" style="text-align: center; padding: 40px; color: #666; display: none;">
                        <h3>üòï –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–ª–æ–¥</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–¥—É, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–ù–æ–≤–∞—è –∫–æ–ª–æ–¥–∞" –≤—ã—à–µ</p>
                    </div>
                </div>

                <!-- –ü–∞–ø–∫–∏ -->
                <div id="folders-tab" class="tab-content">
                    <h2>üìÅ –ü–∞–ø–∫–∏</h2>
                    <button onclick="showCreateFolderModal()" class="btn-success" style="margin: 15px 0;">+ –ù–æ–≤–∞—è –ø–∞–ø–∫–∞</button>
                    <div id="folders-list"></div>
                </div>

                <!-- –ö–æ–ª–æ–¥—ã -->
                <div id="decks-tab" class="tab-content">
                    <h2>üÉè –í—Å–µ –∫–æ–ª–æ–¥—ã</h2>
                    <button onclick="showCreateDeckModal()" class="btn-success" style="margin: 15px 0;">+ –ù–æ–≤–∞—è –∫–æ–ª–æ–¥–∞</button>
                    <div id="decks-list"></div>
                </div>

                <!-- –ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞ -->
                <div id="multi-tab" class="tab-content">
                    <h2>üéØ –ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–¥ –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</p>
                    
                    <div class="multi-select" id="multi-decks-select"></div>
                    
                    <div class="form-group">
                        <label><strong>–†–µ–∂–∏–º –æ—Ç–±–æ—Ä–∞ —Å–ª–æ–≤:</strong></label>
                        <select id="multi-mode">
                            <option value="all">–í—Å–µ —Å–ª–æ–≤–∞ –∏–∑ –∫–æ–ª–æ–¥</option>
                            <option value="unknown">–¢–æ–ª—å–∫–æ –Ω–µ–∏–∑—É—á–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</option>
                            <option value="iteration">–ò–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π</option>
                        </select>
                    </div>
                    
                    <div id="iteration-selectors" style="display: none;"></div>
                    
                    <button onclick="startMultiDeck()" class="btn-success">–ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ</button>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div id="stats-tab" class="tab-content">
                    <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div>–í—Å–µ–≥–æ —Å–ª–æ–≤</div>
                            <div class="stat-number" id="total-words">0</div>
                        </div>
                        <div class="stat-card">
                            <div>–ò–∑—É—á–µ–Ω–æ</div>
                            <div class="stat-number" id="learned-words">0</div>
                        </div>
                        <div class="stat-card">
                            <div>–ö–æ–ª–æ–¥</div>
                            <div class="stat-number" id="total-decks">0</div>
                        </div>
                        <div class="stat-card">
                            <div>–ü–∞–ø–æ–∫</div>
                            <div class="stat-number" id="total-folders">0</div>
                        </div>
                    </div>
                    
                    <h3 style="margin: 25px 0 15px 0;">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–æ–ª–æ–¥–∞–º:</h3>
                    <div id="deck-stats"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∏–∑—É—á–µ–Ω–∏—è (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) -->
    <div class="study-screen" id="study-screen">
        <div class="study-header">
            <button class="close-btn" onclick="exitStudy()">‚Üê</button>
            <div id="study-title">–ò–∑—É—á–µ–Ω–∏–µ</div>
            <div id="study-progress">0/0</div>
        </div>

        <div class="card-container">
            <div class="card" id="flashcard" 
                 ontouchstart="handleTouchStart(event)" 
                 ontouchmove="handleTouchMove(event)" 
                 ontouchend="handleTouchEnd(event)"
                 onclick="flipCard()">
                <div class="card-inner" id="card-inner">
                    <div class="card-front" id="card-front"></div>
                    <div class="card-back" id="card-back"></div>
                </div>
            </div>
        </div>

        <div class="progress-info">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <div>–ó–Ω–∞—é: <span id="known-count">0</span></div>
                <div>–ù–µ –∑–Ω–∞—é: <span id="unknown-count">0</span></div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div style="text-align: center; margin-top: 5px; font-size: 14px;" id="remaining-cards">–û—Å—Ç–∞–ª–æ—Å—å: 0</div>
        </div>

        <div class="study-controls">
            <button class="swipe-btn swipe-left" onclick="markUnknown()">‚ùå –ù–µ –∑–Ω–∞—é</button>
            <button style="background: #4f46e5; color: white; border-radius: 10px; padding: 15px 30px;" onclick="flipCard()">üîÑ –ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å</button>
            <button class="swipe-btn swipe-right" onclick="markKnown()">‚úÖ –ó–Ω–∞—é</button>
        </div>

        <div class="study-controls">
            <button onclick="toggleShuffle()" id="shuffle-btn" style="background: #f1f5f9; color: #1f2937; border-radius: 20px; padding: 10px 20px;">
                üîÄ –ü–µ—Ä–µ–º–µ—à–∏–≤–∞—Ç—å: –≤—ã–∫–ª
            </button>
            <button onclick="toggleReverse()" id="reverse-btn" style="background: #f1f5f9; color: #1f2937; border-radius: 20px; padding: 10px 20px;">
                üîÑ –û–±—Ä–∞—Ç–Ω–æ: –≤—ã–∫–ª
            </button>
            <button onclick="restartDeck()" class="btn-danger" style="border-radius: 20px; padding: 10px 20px;">
                üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="create-folder-modal" class="modal">
        <div class="modal-content">
            <h3>–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</h3>
            <div class="form-group">
                <input type="text" id="folder-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏">
            </div>
            <button onclick="createFolder()" class="btn-success">–°–æ–∑–¥–∞—Ç—å</button>
            <button onclick="closeModal('create-folder-modal')" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="create-deck-modal" class="modal">
        <div class="modal-content">
            <h3>–°–æ–∑–¥–∞—Ç—å –∫–æ–ª–æ–¥—É</h3>
            <div class="form-group">
                <input type="text" id="deck-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã">
            </div>
            <div class="form-group">
                <textarea id="deck-words" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
—Å–ª–æ–≤–æ: –ø–µ—Ä–µ–≤–æ–¥
apple: —è–±–ª–æ–∫–æ
cat: –∫–æ—Ç
..." rows="8"></textarea>
            </div>
            <div class="form-group">
                <label>–ü–∞–ø–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                <select id="deck-folder">
                    <option value="">–ë–µ–∑ –ø–∞–ø–∫–∏</option>
                </select>
            </div>
            <button onclick="createDeck()" class="btn-success">–°–æ–∑–¥–∞—Ç—å –∫–æ–ª–æ–¥—É</button>
            <button onclick="closeModal('create-deck-modal')" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="add-words-modal" class="modal">
        <div class="modal-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞ –≤ –∫–æ–ª–æ–¥—É</h3>
            <div class="form-group">
                <textarea id="new-words" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
—Å–ª–æ–≤–æ: –ø–µ—Ä–µ–≤–æ–¥
apple: —è–±–ª–æ–∫–æ
cat: –∫–æ—Ç
..." rows="8"></textarea>
            </div>
            <button onclick="addWordsToDeck()" class="btn-success">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞</button>
            <button onclick="closeModal('add-words-modal')" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        let appData = {
            decks: [],
            folders: [],
            currentStudy: null,
            currentDeck: null
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–º–∞—Ö–∏–≤–∞–Ω–∏—è
        let touchStartX = 0;
        let touchEndX = 0;
        let isSwiping = false;
        let swipeThreshold = 50;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderHome();
            updateStats();
            checkEmptyState();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
            const saved = localStorage.getItem('flashcardAppData');
            if (saved) {
                try {
                    appData = JSON.parse(saved);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            localStorage.setItem('flashcardAppData', JSON.stringify(appData));
        }

        // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
        function showMobileTab(tabId) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.mobile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll(`.mobile-tab`).forEach(tab => {
                if (tab.textContent.includes(getTabEmoji(tabId))) {
                    tab.classList.add('active');
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏
            switch(tabId) {
                case 'home':
                    renderHome();
                    break;
                case 'folders':
                    renderFolders();
                    break;
                case 'decks':
                    renderDecks();
                    break;
                case 'multi':
                    renderMulti();
                    break;
                case 'stats':
                    updateStats();
                    break;
            }
        }

        function getTabEmoji(tabId) {
            const emojis = {
                'home': 'üè†',
                'folders': 'üìÅ',
                'decks': 'üÉè',
                'multi': 'üéØ',
                'stats': 'üìä'
            };
            return emojis[tabId] || 'üìÑ';
        }

        // –†–µ–Ω–¥–µ—Ä –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function renderHome() {
            const container = document.getElementById('home-decks-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.decks.forEach(deck => {
                const folder = deck.folderId ? appData.folders.find(f => f.id == deck.folderId) : null;
                const iterations = deck.iterations || [];
                
                const deckCard = document.createElement('div');
                deckCard.className = 'deck-card';
                deckCard.innerHTML = `
                    <div class="deck-header">
                        <div>
                            <h4 style="margin: 0;">${deck.name}</h4>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                ${deck.words.length} —Å–ª–æ–≤
                                ${folder ? `<br>üìÅ ${folder.name}` : ''}
                            </div>
                        </div>
                        <div class="deck-actions">
                            <button onclick="studyDeck(${deck.id})" class="action-btn btn-primary">–£—á–∏—Ç—å</button>
                            <button onclick="addWordsToDeckModal(${deck.id})" class="action-btn btn-success">+</button>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <button onclick="deleteDeck(${deck.id})" class="action-btn btn-danger" style="width: 100%;">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                container.appendChild(deckCard);
            });
            
            checkEmptyState();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function checkEmptyState() {
            const noDecksMsg = document.getElementById('no-decks-message');
            const decksList = document.getElementById('home-decks-list');
            
            if (appData.decks.length === 0) {
                noDecksMsg.style.display = 'block';
                if (decksList) decksList.style.display = 'none';
            } else {
                noDecksMsg.style.display = 'none';
                if (decksList) decksList.style.display = 'grid';
            }
        }

        // –†–µ–Ω–¥–µ—Ä –ø–∞–ø–æ–∫
        function renderFolders() {
            const container = document.getElementById('folders-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (appData.folders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–∞–ø–æ–∫</p>';
                return;
            }
            
            appData.folders.forEach(folder => {
                const folderDecks = appData.decks.filter(d => d.folderId == folder.id);
                
                const folderItem = document.createElement('div');
                folderItem.className = 'folder-item';
                folderItem.innerHTML = `
                    <div class="folder-header">
                        <h3 style="margin: 0;">üìÅ ${folder.name}</h3>
                        <button onclick="deleteFolder(${folder.id})" class="btn-danger" style="width: auto;">√ó</button>
                    </div>
                    <div style="color: #666; margin-bottom: 10px;">
                        –ö–æ–ª–æ–¥: ${folderDecks.length}
                    </div>
                    ${folderDecks.length > 0 ? `
                        <div style="background: white; padding: 10px; border-radius: 8px;">
                            ${folderDecks.map(deck => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #f1f5f9;">
                                    <span>${deck.name} (${deck.words.length} —Å–ª–æ–≤)</span>
                                    <button onclick="studyDeck(${deck.id})" style="padding: 5px 10px; background: #4f46e5; color: white; border: none; border-radius: 5px;">–£—á–∏—Ç—å</button>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                container.appendChild(folderItem);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∫–æ–ª–æ–¥
        function renderDecks() {
            const container = document.getElementById('decks-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.decks.forEach(deck => {
                const folder = deck.folderId ? appData.folders.find(f => f.id == deck.folderId) : null;
                
                const deckEl = document.createElement('div');
                deckEl.className = 'deck-card';
                deckEl.innerHTML = `
                    <div class="deck-header">
                        <div>
                            <h4 style="margin: 0;">${deck.name}</h4>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                ${deck.words.length} —Å–ª–æ–≤
                                ${folder ? ` | üìÅ ${folder.name}` : ''}
                            </div>
                        </div>
                        <div class="deck-actions">
                            <button onclick="studyDeck(${deck.id})" class="action-btn btn-primary">–£—á–∏—Ç—å</button>
                        </div>
                    </div>
                    <div style="margin-top: 10px; display: flex; gap: 5px;">
                        <button onclick="addWordsToDeckModal(${deck.id})" class="action-btn btn-success" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–∞</button>
                        <button onclick="deleteDeck(${deck.id})" class="action-btn btn-danger" style="flex: 1;">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                container.appendChild(deckEl);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –º—É–ª—å—Ç–∏–∫–æ–ª–æ–¥—ã
        function renderMulti() {
            const container = document.getElementById('multi-decks-select');
            if (!container) return;
            
            container.innerHTML = '';
            
            appData.decks.forEach(deck => {
                const div = document.createElement('div');
                div.style.cssText = 'padding: 10px; border-bottom: 1px solid #e2e8f0;';
                div.innerHTML = `
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" value="${deck.id}" style="margin-right: 10px;">
                        <div>
                            <strong>${deck.name}</strong>
                            <div style="font-size: 0.9em; color: #666;">
                                ${deck.words.length} —Å–ª–æ–≤, –∏—Ç–µ—Ä–∞—Ü–∏–π: ${deck.iterations?.length || 0}
                            </div>
                        </div>
                    </label>
                `;
                container.appendChild(div);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∂–∏–º–∞
            document.getElementById('multi-mode').addEventListener('change', (e) => {
                const iterationSelectors = document.getElementById('iteration-selectors');
                iterationSelectors.style.display = e.target.value === 'iteration' ? 'block' : 'none';
                if (e.target.value === 'iteration') {
                    renderIterationSelectors();
                }
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏
        function showCreateFolderModal() {
            showModal('create-folder-modal');
        }

        function createFolder() {
            const name = document.getElementById('folder-name').value.trim();
            if (!name) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏');

            const folder = {
                id: Date.now(),
                name: name,
                decks: []
            };

            appData.folders.push(folder);
            saveData();
            closeModal('create-folder-modal');
            document.getElementById('folder-name').value = '';
            showNotification('–ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            if (document.getElementById('folders-tab').classList.contains('active')) {
                renderFolders();
            }
            updateStats();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function showCreateDeckModal() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫
            const folderSelect = document.getElementById('deck-folder');
            folderSelect.innerHTML = '<option value="">–ë–µ–∑ –ø–∞–ø–∫–∏</option>';
            appData.folders.forEach(folder => {
                folderSelect.innerHTML += `<option value="${folder.id}">${folder.name}</option>`;
            });
            
            showModal('create-deck-modal');
        }

        function createDeck() {
            const name = document.getElementById('deck-name').value.trim();
            const wordsText = document.getElementById('deck-words').value.trim();
            const folderId = document.getElementById('deck-folder').value;

            if (!name) return showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã');
            if (!wordsText) return showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞');

            const words = parseWords(wordsText);
            if (words.length === 0) return showNotification('–ù–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å–ª–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "—Å–ª–æ–≤–æ:–ø–µ—Ä–µ–≤–æ–¥"');

            const deck = {
                id: Date.now(),
                name: name,
                words: words,
                folderId: folderId || null,
                createdAt: new Date().toISOString(),
                iterations: [],
                currentSession: null
            };

            appData.decks.push(deck);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–∞–ø–∫—É –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞
            if (folderId) {
                const folder = appData.folders.find(f => f.id == folderId);
                if (folder) {
                    folder.decks.push(deck.id);
                }
            }

            saveData();
            closeModal('create-deck-modal');
            document.getElementById('deck-name').value = '';
            document.getElementById('deck-words').value = '';
            
            showNotification('–ö–æ–ª–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞!');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderHome();
            if (document.getElementById('decks-tab').classList.contains('active')) {
                renderDecks();
            }
            updateStats();
            checkEmptyState();
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–≤ —Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º
        function parseWords(text) {
            const lines = text.split('\n');
            const words = [];
            let index = 0;

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                const colonIndex = line.indexOf(':');
                if (colonIndex !== -1) {
                    const eng = line.substring(0, colonIndex).trim();
                    const rus = line.substring(colonIndex + 1).trim();
                    if (eng && rus) {
                        words.push({
                            eng: eng,
                            rus: rus,
                            index: index++
                        });
                    }
                }
            });

            return words;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤ –≤ –∫–æ–ª–æ–¥—É
        function addWordsToDeckModal(deckId) {
            appData.currentDeck = appData.decks.find(d => d.id == deckId);
            showModal('add-words-modal');
        }

        function addWordsToDeck() {
            if (!appData.currentDeck) return;
            
            const text = document.getElementById('new-words').value.trim();
            if (!text) return showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞');

            const newWords = parseWords(text);
            const existingEngWords = new Set(appData.currentDeck.words.map(w => w.eng.toLowerCase()));

            let addedCount = 0;
            newWords.forEach(word => {
                if (!existingEngWords.has(word.eng.toLowerCase())) {
                    word.index = appData.currentDeck.words.length;
                    appData.currentDeck.words.push(word);
                    existingEngWords.add(word.eng.toLowerCase());
                    addedCount++;
                }
            });

            saveData();
            closeModal('add-words-modal');
            document.getElementById('new-words').value = '';
            showNotification(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} –Ω–æ–≤—ã—Ö —Å–ª–æ–≤`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderHome();
            renderDecks();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function deleteDeck(deckId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–¥—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;

            appData.decks = appData.decks.filter(d => d.id !== deckId);
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –ø–∞–ø–æ–∫
            appData.folders.forEach(folder => {
                folder.decks = folder.decks.filter(id => id !== deckId);
            });

            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderHome();
            renderDecks();
            renderFolders();
            updateStats();
            checkEmptyState();
            showNotification('–ö–æ–ª–æ–¥–∞ —É–¥–∞–ª–µ–Ω–∞');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏
        function deleteFolder(folderId) {
            const folder = appData.folders.find(f => f.id == folderId);
            if (folder.decks.length > 0) {
                if (!confirm('–í –ø–∞–ø–∫–µ –µ—Å—Ç—å –∫–æ–ª–æ–¥—ã. –£–¥–∞–ª–∏—Ç—å –ø–∞–ø–∫—É –∏ –≤—Å–µ –∫–æ–ª–æ–¥—ã –≤–Ω—É—Ç—Ä–∏?')) return;
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–ª–æ–¥—ã –≤ –ø–∞–ø–∫–µ
                appData.decks = appData.decks.filter(d => d.folderId !== folderId);
            }
            
            appData.folders = appData.folders.filter(f => f.id !== folderId);
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderHome();
            renderFolders();
            updateStats();
            showNotification('–ü–∞–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
        }

        // –ò–∑—É—á–µ–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function studyDeck(deckId) {
            const deck = appData.decks.find(d => d.id == deckId);
            if (!deck) return;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–ª–æ–¥—É
            appData.currentDeck = deck;
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
            if (deck.currentSession) {
                appData.currentStudy = deck.currentSession;
            } else {
                appData.currentStudy = {
                    deckId: deckId,
                    currentIndex: 0,
                    knownWords: [],
                    unknownWords: [],
                    currentIteration: (deck.iterations?.length || 0) + 1,
                    shuffled: false,
                    reversed: false,
                    wordOrder: deck.words.map((_, idx) => idx)
                };
            }
            
            document.getElementById('study-title').textContent = deck.name;
            document.getElementById('study-screen').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            updateStudyUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–∑—É—á–µ–Ω–∏—è
        function updateStudyUI() {
            if (!appData.currentStudy || !appData.currentDeck) return;

            const study = appData.currentStudy;
            const deck = appData.currentDeck;
            
            if (deck.words.length === 0) {
                document.getElementById('card-front').textContent = '–ù–µ—Ç —Å–ª–æ–≤ –≤ –∫–æ–ª–æ–¥–µ';
                document.getElementById('card-back').textContent = '–î–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞';
                return;
            }

            const currentWordIndex = study.wordOrder[study.currentIndex];
            const currentWord = deck.words[currentWordIndex];

            document.getElementById('card-front').textContent = study.reversed ? currentWord.rus : currentWord.eng;
            document.getElementById('card-back').textContent = study.reversed ? currentWord.eng : currentWord.rus;
            document.getElementById('flashcard').classList.remove('flipped');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            document.getElementById('study-progress').textContent = `${study.currentIndex + 1}/${deck.words.length}`;
            document.getElementById('known-count').textContent = study.knownWords.length;
            document.getElementById('unknown-count').textContent = study.unknownWords.length;
            
            const progress = ((study.currentIndex) / deck.words.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            
            const remaining = deck.words.length - (study.currentIndex);
            document.getElementById('remaining-cards').textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${remaining}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('shuffle-btn').textContent = `üîÄ –ü–µ—Ä–µ–º–µ—à–∏–≤–∞—Ç—å: ${study.shuffled ? '–≤–∫–ª' : '–≤—ã–∫–ª'}`;
            document.getElementById('reverse-btn').textContent = `üîÑ –û–±—Ä–∞—Ç–Ω–æ: ${study.reversed ? '–≤–∫–ª' : '–≤—ã–∫–ª'}`;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            saveStudyProgress();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑—É—á–µ–Ω–∏—è
        function saveStudyProgress() {
            if (!appData.currentStudy || !appData.currentDeck) return;
            
            const deck = appData.decks.find(d => d.id === appData.currentDeck.id);
            if (deck) {
                deck.currentSession = appData.currentStudy;
                saveData();
            }
        }

        // –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        // –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–Ω–∞—é
        function markKnown() {
            if (!appData.currentStudy) return;
            
            const study = appData.currentStudy;
            const currentWordIndex = study.wordOrder[study.currentIndex];
            
            if (!study.knownWords.includes(currentWordIndex)) {
                study.knownWords.push(currentWordIndex);
                // –£–¥–∞–ª—è–µ–º –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å
                study.unknownWords = study.unknownWords.filter(idx => idx !== currentWordIndex);
            }
            
            nextCard();
        }

        // –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ –∑–Ω–∞—é
        function markUnknown() {
            if (!appData.currentStudy) return;
            
            const study = appData.currentStudy;
            const currentWordIndex = study.wordOrder[study.currentIndex];
            
            if (!study.unknownWords.includes(currentWordIndex)) {
                study.unknownWords.push(currentWordIndex);
                // –£–¥–∞–ª—è–µ–º –∏–∑ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –µ—Å–ª–∏ —Ç–∞–º –µ—Å—Ç—å
                study.knownWords = study.knownWords.filter(idx => idx !== currentWordIndex);
            }
            
            nextCard();
        }

        // –°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
        function nextCard() {
            if (!appData.currentStudy) return;
            
            const study = appData.currentStudy;
            study.currentIndex++;
            
            if (study.currentIndex >= appData.currentDeck.words.length) {
                finishStudySession();
            } else {
                updateStudyUI();
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏–∑—É—á–µ–Ω–∏—è
        function finishStudySession() {
            if (!appData.currentStudy || !appData.currentDeck) return;
            
            const study = appData.currentStudy;
            const deck = appData.decks.find(d => d.id === appData.currentDeck.id);
            
            if (deck) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ç–µ—Ä–∞—Ü–∏—é
                const iteration = {
                    number: study.currentIteration,
                    date: new Date().toISOString(),
                    totalWords: deck.words.length,
                    knownWords: [...study.knownWords],
                    unknownWords: [...study.unknownWords]
                };
                
                if (!deck.iterations) deck.iterations = [];
                deck.iterations.push(iteration);
                
                // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
                deck.currentSession = null;
                
                saveData();
                updateStats();
                
                showNotification(`–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ó–Ω–∞–µ—Ç–µ: ${study.knownWords.length}, –ù–µ –∑–Ω–∞–µ—Ç–µ: ${study.unknownWords.length}`);
                exitStudy();
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ –∏–∑—É—á–µ–Ω–∏—è
        function exitStudy() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
            if (appData.currentStudy && appData.currentDeck) {
                const deck = appData.decks.find(d => d.id === appData.currentDeck.id);
                if (deck) {
                    deck.currentSession = appData.currentStudy;
                    saveData();
                }
            }
            
            document.getElementById('study-screen').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            appData.currentStudy = null;
            appData.currentDeck = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            renderHome();
            updateStats();
        }

        // –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
        function restartDeck() {
            if (!appData.currentStudy || !appData.currentDeck) return;
            
            appData.currentStudy.currentIndex = 0;
            appData.currentStudy.knownWords = [];
            appData.currentStudy.unknownWords = [];
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (!appData.currentStudy.shuffled) {
                appData.currentStudy.wordOrder = appData.currentDeck.words.map((_, idx) => idx);
            }
            
            updateStudyUI();
            showNotification('–°–µ—Å—Å–∏—è –Ω–∞—á–∞—Ç–∞ –∑–∞–Ω–æ–≤–æ');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
        function toggleShuffle() {
            if (!appData.currentStudy) return;
            
            const study = appData.currentStudy;
            study.shuffled = !study.shuffled;
            
            if (study.shuffled) {
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫
                shuffleArray(study.wordOrder);
                study.currentIndex = 0;
                showNotification('–ö–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã');
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
                study.wordOrder = appData.currentDeck.words.map((_, idx) => idx);
                showNotification('–ü–æ—Ä—è–¥–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            }
            
            updateStudyUI();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É
        function toggleReverse() {
            if (!appData.currentStudy) return;
            
            appData.currentStudy.reversed = !appData.currentStudy.reversed;
            updateStudyUI();
            showNotification(appData.currentStudy.reversed ? '–ü–æ–∫–∞–∑—ã–≤–∞—é —Å –ø–µ—Ä–µ–≤–æ–¥–∞' : '–ü–æ–∫–∞–∑—ã–≤–∞—é —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–∞');
        }

        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–º–∞—Ö–∏–≤–∞–Ω–∏—è
        function handleTouchStart(event) {
            touchStartX = event.touches[0].clientX;
            isSwiping = true;
        }

        function handleTouchMove(event) {
            if (!isSwiping) return;
            
            touchEndX = event.touches[0].clientX;
            const diff = touchEndX - touchStartX;
            
            // –°–º–µ—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
            const cardInner = document.getElementById('card-inner');
            const rotate = diff * 0.1;
            cardInner.style.transform = `rotateY(${rotate}deg)`;
        }

        function handleTouchEnd() {
            if (!isSwiping) return;
            
            isSwiping = false;
            const diff = touchEndX - touchStartX;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            const cardInner = document.getElementById('card-inner');
            cardInner.style.transform = '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
            if (diff > swipeThreshold) {
                // –°–º–∞—Ö–∏–≤–∞–Ω–∏–µ –≤–ø—Ä–∞–≤–æ - –∑–Ω–∞—é
                markKnown();
            } else if (diff < -swipeThreshold) {
                // –°–º–∞—Ö–∏–≤–∞–Ω–∏–µ –≤–ª–µ–≤–æ - –Ω–µ –∑–Ω–∞—é
                markUnknown();
            }
        }

        // –ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞
        function renderIterationSelectors() {
            const container = document.getElementById('iteration-selectors');
            container.innerHTML = '<h4>–í—ã–±–µ—Ä–∏—Ç–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏:</h4>';
            
            appData.decks.forEach(deck => {
                if (deck.iterations && deck.iterations.length > 0) {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <div><strong>${deck.name}:</strong></div>
                        <div class="iteration-selector" id="iterations-${deck.id}"></div>
                    `;
                    container.appendChild(div);
                    
                    const selector = document.getElementById(`iterations-${deck.id}`);
                    selector.innerHTML = '';
                    deck.iterations.forEach(iter => {
                        const btn = document.createElement('button');
                        btn.className = 'iteration-btn';
                        btn.textContent = `–ò—Ç–µ—Ä–∞—Ü–∏—è ${iter.number}`;
                        btn.dataset.deckId = deck.id;
                        btn.dataset.iterNum = iter.number;
                        btn.onclick = function() {
                            document.querySelectorAll(`#iterations-${deck.id} .iteration-btn`).forEach(b => 
                                b.classList.remove('active')
                            );
                            this.classList.add('active');
                        };
                        selector.appendChild(btn);
                    });
                }
            });
        }

        function startMultiDeck() {
            const selectedDeckIds = Array.from(
                document.querySelectorAll('#multi-decks-select input:checked')
            ).map(input => parseInt(input.value));
            
            if (selectedDeckIds.length === 0) {
                return showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–æ–ª–æ–¥—É');
            }
            
            const mode = document.getElementById('multi-mode').value;
            let allWords = [];
            let deckName = '–ú—É–ª—å—Ç–∏–∫–æ–ª–æ–¥–∞';
            
            selectedDeckIds.forEach(deckId => {
                const deck = appData.decks.find(d => d.id == deckId);
                if (!deck) return;
                
                let wordsToAdd = [];
                
                if (mode === 'all') {
                    wordsToAdd = deck.words.map(w => ({...w, deckId: deck.id}));
                } else if (mode === 'unknown') {
                    // –ë–µ—Ä–µ–º —Å–ª–æ–≤–∞ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–Ω–∞–ª
                    if (deck.iterations && deck.iterations.length > 0) {
                        const lastIter = deck.iterations[deck.iterations.length - 1];
                        wordsToAdd = deck.words
                            .filter((_, idx) => lastIter.unknownWords.includes(idx))
                            .map(w => ({...w, deckId: deck.id}));
                    } else {
                        wordsToAdd = deck.words.map(w => ({...w, deckId: deck.id}));
                    }
                } else if (mode === 'iteration') {
                    // –ë–µ—Ä–µ–º —Å–ª–æ–≤–∞ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
                    const iterBtn = document.querySelector(`#iterations-${deckId} .iteration-btn.active`);
                    if (iterBtn) {
                        const iterNum = parseInt(iterBtn.dataset.iterNum);
                        const iteration = deck.iterations.find(iter => iter.number === iterNum);
                        if (iteration) {
                            wordsToAdd = deck.words
                                .filter((_, idx) => iteration.unknownWords.includes(idx))
                                .map(w => ({...w, deckId: deck.id}));
                        }
                    } else {
                        showNotification(`–î–ª—è –∫–æ–ª–æ–¥—ã "${deck.name}" –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è`);
                        return;
                    }
                }
                
                allWords = [...allWords, ...wordsToAdd];
            });
            
            if (allWords.length === 0) {
                return showNotification('–ù–µ—Ç —Å–ª–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è');
            }
            
            // –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–æ–ª–æ–¥—É
            appData.currentDeck = {
                id: 'multi-' + Date.now(),
                name: deckName,
                words: allWords
            };
            
            appData.currentStudy = {
                deckId: 'multi',
                currentIndex: 0,
                knownWords: [],
                unknownWords: [],
                currentIteration: 1,
                shuffled: false,
                reversed: false,
                wordOrder: allWords.map((_, idx) => idx)
            };
            
            document.getElementById('study-title').textContent = deckName;
            document.getElementById('study-screen').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            updateStudyUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            let totalWords = 0;
            let learnedWords = 0;
            let totalKnown = 0;
            let totalUnknown = 0;
            
            appData.decks.forEach(deck => {
                totalWords += deck.words.length;
                
                if (deck.iterations && deck.iterations.length > 0) {
                    const lastIter = deck.iterations[deck.iterations.length - 1];
                    totalKnown += lastIter.knownWords.length;
                    totalUnknown += lastIter.unknownWords.length;
                }
            });
            
            learnedWords = totalKnown;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('total-words').textContent = totalWords;
            document.getElementById('learned-words').textContent = learnedWords;
            document.getElementById('total-decks').textContent = appData.decks.length;
            document.getElementById('total-folders').textContent = appData.folders.length;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–æ–ª–æ–¥–∞–º
            const deckStats = document.getElementById('deck-stats');
            deckStats.innerHTML = '';
            
            appData.decks.forEach(deck => {
                const lastIter = deck.iterations && deck.iterations.length > 0 
                    ? deck.iterations[deck.iterations.length - 1]
                    : null;
                
                const statEl = document.createElement('div');
                statEl.className = 'deck-card';
                statEl.innerHTML = `
                    <div class="deck-header">
                        <div>
                            <h4 style="margin: 0;">${deck.name}</h4>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                –°–ª–æ–≤: ${deck.words.length}
                                ${lastIter ? ` | –ó–Ω–∞–µ—Ç: ${lastIter.knownWords.length}` : ''}
                            </div>
                        </div>
                        <button onclick="studyDeck(${deck.id})" class="action-btn btn-primary">–£—á–∏—Ç—å</button>
                    </div>
                `;
                deckStats.appendChild(statEl);
            });
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = 'flashcards-backup.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        }

        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        appData = importedData;
                        saveData();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ UI
                        renderHome();
                        renderFolders();
                        renderDecks();
                        updateStats();
                        checkEmptyState();
                        
                        showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                    } catch (err) {
                        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
    </script>
</body>
</html>
